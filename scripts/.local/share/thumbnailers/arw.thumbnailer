#!/bin/bash
# Arguments: $1=input, $2=output, $3=size

ORIENT=$(exiftool -n -S -Orientation# "$1" | awk '{print $2}')

case "$ORIENT" in
    8) ANGLE=270 ;;
    6) ANGLE=90  ;;
    3) ANGLE=180 ;;
    *) ANGLE=0   ;;
esac

exiftool -b -PreviewImage "$1" | convert - -rotate "$ANGLE" -thumbnail "$3x$3" "$2"
